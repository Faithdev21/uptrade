{% with item=node.item children=node.children %}
    <li class="{% if item.id in active_ids %}open{% endif %} {% if item.id == active_item_id %}active{% endif %}">
        <a href="{{ item.get_url }}">{{ item.title }}</a>
        {% if children %}
            {% if item.id in active_ids %}
                <ul>
                    {% for child in children %}
                        {% include "tree_menu/menu_item.html" with node=child active_ids=active_ids active_item_id=active_item_id %}
                    {% endfor %}
                </ul>
            {% elif item.id == active_item_id %}
                <ul>
                    {% for child in children %}
                        {% include "tree_menu/menu_item.html" with node=child active_ids=active_ids active_item_id=active_item_id %}
                    {% endfor %}
                </ul>
            {% endif %}
        {% endif %}
    </li>
{% endwith %}